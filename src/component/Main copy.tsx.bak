import React, { useEffect, useState } from 'react';
import Grid from '@mui/material/Grid';
import Typography from '@mui/material/Typography';
import Divider from '@mui/material/Divider';
import instance from '../api/CommonAxios';
import { QueryClient, useMutation, useQuery, useQueryClient } from '@tanstack/react-query';
import axios from 'axios';

interface MainProps {
  posts:string;
  title: string;
}

async function getUnityAirEnvrnIdexSnstiveAboveMsrstnList(sidoName: String){
  const _params = "/B552584/ArpltnInforInqireSvc/getCtprvnRltmMesureDnsty?sidoName=%EC%84%9C%EC%9A%B8&pageNo=1&numOfRows=100&returnType=json&serviceKey=LFz9dGOoxURk2A8NOe%2BtaBYrx8CyRSTixm0A46pa3tC%2Bwr2VwdO7O3Bpmt46s45nRukeFQfqA12oWocpDqH%2B9A%3D%3D&ver=1.0";
  try {
    // 위에서 지정한 baseURL 뒤에 다음 URL이 붙는다.
    const result = await instance.get(_params);
    console.log(result);
    debugger;
    return result.data.response.body.items;
  } catch (error) {
    console.log(error);
  }
}

const fetchtempData  = async (name:string) => {
  const baseUrl = "http://apis.data.go.kr"
  const url = baseUrl+"/B552584/ArpltnInforInqireSvc/getCtprvnRltmMesureDnsty?sidoName=%EC%84%9C%EC%9A%B8&pageNo=1&numOfRows=100&returnType=json&serviceKey=LFz9dGOoxURk2A8NOe%2BtaBYrx8CyRSTixm0A46pa3tC%2Bwr2VwdO7O3Bpmt46s45nRukeFQfqA12oWocpDqH%2B9A%3D%3D&ver=1.0"
  try{
    const res = await axios.get(url);  
    // return res.data;
    debugger;
    console.log(res.data.response.body.items);
    return res.data.response.body.items;
  }catch(error){
    console.log(error);
    return error;
  }
}
const fetchtempData2  = async () => {
  const url = "http://apis.data.go.kr/B552584/ArpltnInforInqireSvc/getCtprvnRltmMesureDnsty?sidoName=%EC%84%9C%EC%9A%B8&pageNo=1&numOfRows=100&returnType=json&serviceKey=LFz9dGOoxURk2A8NOe%2BtaBYrx8CyRSTixm0A46pa3tC%2Bwr2VwdO7O3Bpmt46s45nRukeFQfqA12oWocpDqH%2B9A%3D%3D&ver=1.0"
  try{
    const res = await axios.get(url);  
    // return res.data;
    debugger;
    console.log(res.data.response.body.items);
    return res.data.response.body.items;
  }catch(error){
    console.log(error);    
    return error;
  }
}



export default function Main(props: MainProps) {
  const { posts, title } = props;
  // const url = "https://apis.data.go.kr/B552584/ArpltnInforInqireSvc/getUnityAirEnvrnIdexSnstiveAboveMsrstnList?serviceKey=LFz9dGOoxURk2A8NOe%2BtaBYrx8CyRSTixm0A46pa3tC%2Bwr2VwdO7O3Bpmt46s45nRukeFQfqA12oWocpDqH%2B9A%3D%3D&returnType=json&numOfRows=100&pageNo=1"
  const url = "http://apis.data.go.kr/B552584/ArpltnInforInqireSvc/getCtprvnRltmMesureDnsty?sidoName=%EC%84%9C%EC%9A%B8&pageNo=1&numOfRows=100&returnType=json&serviceKey=LFz9dGOoxURk2A8NOe%2BtaBYrx8CyRSTixm0A46pa3tC%2Bwr2VwdO7O3Bpmt46s45nRukeFQfqA12oWocpDqH%2B9A%3D%3D&ver=1.0"
  // const url = "https://5a51cacc-3f5f-41e1-9d51-19ca29070ff3.mock.pstmn.io/products"
  const [airInfos, setAirInfos] = React.useState([]);
  const [point, setPoint] = React.useState(0);
  
  // const { isLoading, isError, data, error } = useQuery({
  //   queryKey: ['temp_query'],
  //   queryFn: fetchtempData2,
  // })

  // const { isLoading, isError, data, error } = useQuery({
  //   queryKey: ['temp_query2', '서울'],
  //   queryFn: ({queryKey})=> fetchtempData(queryKey[1]),
  // })

  const name = '서울';
  // const { isLoading, isError, data, error  } = useQuery({
  //   queryKey: ['temp_query3', name],
  //   queryFn:()=> fetchtempData(name),
  // })

  const { isLoading, isError, data: productInfo  } = useQuery({
    queryKey: ['productInfo', name],
    queryFn:()=> fetchtempData(name),
  })

  useEffect(()=>{
    setPoint(0);
    document.title = '대기정보';

    // const _airInfos = getUnityAirEnvrnIdexSnstiveAboveMsrstnList('서울');
    // console.log("_airInfos:"+_airInfos);
    // setAirInfos(_airInfos);
      // axios
      // .get(
      //   url
      // )
      // .then(function (result) {
      // const _airInfos = result.data.response.body.items;
      // setAirInfos(_airInfos);
      // console.log("useEffect() 호출");
      // debugger;
      // })
      // .catch(function (error) {
      // console.error(error);
      // });
  },[]);

  if (isLoading) {
    return <span>Loading...</span>
  }

  if (isError) {
    return <span>Error</span>
  }


  return (
    <Grid
      item
      xs={12}
      md={8}
      sx={{
        '& .markdown': {
          py: 3,
        },
      }}
    >
      <Typography variant="h6" gutterBottom>
        {title}
      </Typography>
      <Divider />
      <li>{posts}</li>
      <div>          
        <div>대기실  리스트 페이지 입니다.{point}</div>
        {productInfo?.map(function (airInfo: any, index: number) {
            return (
            <div key = {index}>              
                <div>
                <span>{airInfo.sidoName}</span>
                <span>{airInfo.stationName}</span>
                </div>
            </div>
            );
        })}
      </div>
    </Grid>
  );
}
